title: PowerShell - Command Parameter with Encoded Arguments
id: 10598928-44a9-4730-b79f-69b62fe73666
status: test
description: Detects PowerShell - execution using -Command parameter variations with encoded arguments
references:
    - https://attack.mitre.org/techniques/T1059/001/
    - https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.001/T1059.001.md
author: Sujal Chauhan
date: 2025-12-07
modified: 2025-12-25
tags:
    - attack.execution
    - attack.defense_evasion
    - attack.t1059.001
logsource:
    category: process_creation
    product: windows
detection:
    selection_image:
        Image|endswith:
            - '\powershell.exe'
            - '\pwsh.exe'
    
    selection_image_alt:
        OriginalFileName:
            - 'PowerShell.EXE'
            - 'pwsh.dll'
    
    # Detect -NoProfile parameter
    selection_noprofile:
        CommandLine|contains:
            - ' -NoP'
            - ' /NoP'
    
    # Detect -Command parameter variations
    selection_command:
        CommandLine|contains:
            - ' -C '
            - ' /C '
            - ' -Co '
            - ' /Co '
            - ' -Com '
            - ' /Com '
            - ' -Comm '
            - ' -Comma '
            - ' -Comman '
    
    # Detect -EncodedArguments parameter variations (this is key!)
    selection_encoded_args:
        CommandLine|contains:
            - ' -EA '
            - ' /EA '
            - ' -E '
            - ' /E '
            - ' -En '
            - ' -Enc '
            - ' -Enco '
            - ' -Encod '
            - ' -Encode '
            - ' -Encoded '
            - ' -EncodedA '
            - ' -EncodedAr '
            - ' -EncodedArg '
            - ' -EncodedArgs '
            - ' -EncodedArguments '
    
    # Detect base64-like encoded content (50+ chars)
    selection_base64:
        CommandLine|re: '[A-Za-z0-9+/]{50,}={0,2}'
    
    condition: (selection_image or selection_image_alt) and 
               selection_noprofile and 
               (selection_command or selection_encoded_args) and 
               selection_base64
    
falsepositives:
    - Legitimate administrative scripts using abbreviated parameters
    - Monitoring agents that use PowerShell for data collection
    - Software deployment scripts (SCCM, Intune)
    
level: medium
